#! /usr/bin/env bash
STORE=$1

if [ -z "$STORE" ]; then
	echo "Usage: $0 <store> [command|arguments]"
	exit 1
fi

set -eou pipefail
CMD="${@:2}"
PREFIX="${PASSAGE_DIR:-$HOME/.passage/$STORE}"
name="$(find "$PREFIX" -type f -name '*.age' |
	sed -e "s|$PREFIX/||" -e 's|\.age$||' |
	gum filter --height=40 --reverse --limit=1)"
PASSAGE_DIR=$PREFIX passage "${CMD:-show}" "$name"
